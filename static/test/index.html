<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:18,&quot;tests&quot;:37,&quot;passes&quot;:36,&quot;pending&quot;:0,&quot;failures&quot;:1,&quot;start&quot;:&quot;2020-04-21T22:54:09.281Z&quot;,&quot;end&quot;:&quot;2020-04-21T22:54:09.769Z&quot;,&quot;duration&quot;:488,&quot;testsRegistered&quot;:37,&quot;passPercent&quot;:97.2972972972973,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;bd63ecd8-04e6-442c-9d5f-5eeb9bccfcdd&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;jwt-csrf&quot;,&quot;fullTitle&quot;:&quot;jwt-csrf&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_1ighra4x6r().f[0]++;cov_1ighra4x6r().s[1]++;throw new Error(&#x27;TODO&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: TODO&quot;,&quot;estack&quot;:&quot;Error: TODO\n    at Context.&lt;anonymous&gt; (app\\jwt\\jwt-csrf.unit.spec.ts:1:1540)\n    at processImmediate (internal/timers.js:456:21)&quot;,&quot;diff&quot;:null},&quot;uuid&quot;:&quot;a2c374e5-bcf3-4d1a-9f37-7ef833b2d033&quot;,&quot;parentUUID&quot;:&quot;bd63ecd8-04e6-442c-9d5f-5eeb9bccfcdd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a2607664-9f89-4cbd-985e-4851b0972474&quot;,&quot;title&quot;:&quot;LoginController&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\auth\\login\\login-controller.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\auth\\login\\login-controller.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;LoginController \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_h1ok71qyf().f[2]++;cov_h1ok71qyf().s[12]++;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7b6d907b-0c83-4992-a7d8-db52facaf4c5&quot;,&quot;parentUUID&quot;:&quot;a2607664-9f89-4cbd-985e-4851b0972474&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;logs in, if credentials correct&quot;,&quot;fullTitle&quot;:&quot;LoginController logs in, if credentials correct&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_h1ok71qyf().f[3]++;const requestBody=(cov_h1ok71qyf().s[14]++,{username:&#x27;demo&#x27;,email:&#x27;demo@mail.com&#x27;,password:&#x27;123456&#x27;});const dbUser=(cov_h1ok71qyf().s[15]++,{username:&#x27;demo&#x27;,email:&#x27;demo@mail.com&#x27;,password:&#x27;hashed&#x27;,isBetaUser:false,get(){cov_h1ok71qyf().f[4]++;cov_h1ok71qyf().s[16]++;return this;}});const expectedJwt=(cov_h1ok71qyf().s[17]++,{username:&#x27;demo&#x27;,isBetaUser:false});// Stub bcrypt comparing\nconst compareStub=(cov_h1ok71qyf().s[18]++,sandbox.stub(bcrypt_1.default,&#x27;compare&#x27;));cov_h1ok71qyf().s[19]++;compareStub.resolves(true);// Stub database\nconst findByUsernameStub=(cov_h1ok71qyf().s[20]++,sandbox.stub(user_1.default,&#x27;findByUsername&#x27;));cov_h1ok71qyf().s[21]++;findByUsernameStub.usingPromise(bluebird_1.default).resolves(dbUser);// Stub express\nconst requestStub=(cov_h1ok71qyf().s[22]++,sandbox.stub());cov_h1ok71qyf().s[23]++;requestStub.body=requestBody;const responseStub=(cov_h1ok71qyf().s[24]++,sandbox.stub());cov_h1ok71qyf().s[25]++;responseStub.setJwtToken=sinon_1.fake();const next=(cov_h1ok71qyf().s[26]++,sinon_1.fake());cov_h1ok71qyf().s[27]++;responseStub.send=sinon_1.fake(()=&gt;{cov_h1ok71qyf().f[5]++;cov_h1ok71qyf().s[28]++;sandbox.assert.calledWith(compareStub,requestBody.password,dbUser.password);cov_h1ok71qyf().s[29]++;sinon_1.assert.notCalled(next);cov_h1ok71qyf().s[30]++;sandbox.assert.calledOnce(responseStub.send);cov_h1ok71qyf().s[31]++;sandbox.assert.calledWith(responseStub.send,sinon_1.match.instanceOf(user_dto_1.default));cov_h1ok71qyf().s[32]++;sandbox.assert.calledWith(findByUsernameStub,requestBody.username);cov_h1ok71qyf().s[33]++;sandbox.assert.calledOnce(responseStub.setJwtToken);cov_h1ok71qyf().s[34]++;sandbox.assert.calledWith(responseStub.setJwtToken,sinon_1.match(expectedJwt));cov_h1ok71qyf().s[35]++;done();});cov_h1ok71qyf().s[36]++;login_controller_1.default(requestStub,responseStub,next);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3ba68dd8-577f-4543-93b0-abc6e2fabd2b&quot;,&quot;parentUUID&quot;:&quot;a2607664-9f89-4cbd-985e-4851b0972474&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;74de23fc-08eb-40d1-bc93-2b9a51ba652a&quot;,&quot;title&quot;:&quot;throws error&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\auth\\login\\login-controller.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\auth\\login\\login-controller.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;if database throws error while finding user&quot;,&quot;fullTitle&quot;:&quot;LoginController throws error if database throws error while finding user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_h1ok71qyf().f[7]++;const requestBody=(cov_h1ok71qyf().s[39]++,{username:&#x27;demo&#x27;,email:&#x27;demo@mail.com&#x27;,password:&#x27;123456&#x27;});const dbError=(cov_h1ok71qyf().s[40]++,new Error(&#x27;SOME MESSAGE&#x27;));// Stub database\nconst findOneStub=(cov_h1ok71qyf().s[41]++,sandbox.stub(user_1.default,&#x27;findOne&#x27;));cov_h1ok71qyf().s[42]++;findOneStub.usingPromise(bluebird_1.default).rejects(dbError);// Stub express\nconst requestStub=(cov_h1ok71qyf().s[43]++,sandbox.stub());cov_h1ok71qyf().s[44]++;requestStub.body=requestBody;const responseStub=(cov_h1ok71qyf().s[45]++,sandbox.stub());cov_h1ok71qyf().s[46]++;responseStub.send=sandbox.stub();const next=(cov_h1ok71qyf().s[47]++,sinon_1.fake(err=&gt;{cov_h1ok71qyf().f[8]++;cov_h1ok71qyf().s[48]++;sandbox.assert.notCalled(responseStub.send);cov_h1ok71qyf().s[49]++;sinon_1.assert.calledWith(next,sinon_1.match(dbError));cov_h1ok71qyf().s[50]++;done();}));cov_h1ok71qyf().s[51]++;login_controller_1.default(requestStub,responseStub,next);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d2eec959-8538-4132-830c-b19c85bda5a5&quot;,&quot;parentUUID&quot;:&quot;74de23fc-08eb-40d1-bc93-2b9a51ba652a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;if given password doesn&#x27;t match stored hash&quot;,&quot;fullTitle&quot;:&quot;LoginController throws error if given password doesn&#x27;t match stored hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_h1ok71qyf().f[9]++;const requestBody=(cov_h1ok71qyf().s[53]++,{username:&#x27;demo&#x27;,email:&#x27;demo@mail.com&#x27;,password:&#x27;123456&#x27;});const dbUser=(cov_h1ok71qyf().s[54]++,{username:&#x27;demo&#x27;,email:&#x27;demo@mail.com&#x27;,password:&#x27;hashed&#x27;});// Stub bcrypt comparing\nconst compareStub=(cov_h1ok71qyf().s[55]++,sandbox.stub(bcrypt_1.default,&#x27;compare&#x27;));cov_h1ok71qyf().s[56]++;compareStub.resolves(false);// Stub database\nconst findOneStub=(cov_h1ok71qyf().s[57]++,sandbox.stub(user_1.default,&#x27;findOne&#x27;));cov_h1ok71qyf().s[58]++;findOneStub.usingPromise(bluebird_1.default).resolves(dbUser);// Stub express\nconst requestStub=(cov_h1ok71qyf().s[59]++,sandbox.stub());cov_h1ok71qyf().s[60]++;requestStub.body=requestBody;const responseStub=(cov_h1ok71qyf().s[61]++,sandbox.stub());cov_h1ok71qyf().s[62]++;responseStub.send=sandbox.stub();const next=(cov_h1ok71qyf().s[63]++,sinon_1.fake(()=&gt;{cov_h1ok71qyf().f[10]++;cov_h1ok71qyf().s[64]++;sinon_1.assert.notCalled(responseStub.send);cov_h1ok71qyf().s[65]++;sinon_1.assert.calledWith(compareStub,requestBody.password,dbUser.password);cov_h1ok71qyf().s[66]++;sinon_1.assert.calledWith(findOneStub,sinon_1.match({where:{username:requestBody.username}}));cov_h1ok71qyf().s[67]++;sinon_1.assert.calledWith(next,sinon_1.match.hasNested(&#x27;constructor.name&#x27;,&#x27;InvalidLoginError&#x27;));cov_h1ok71qyf().s[68]++;sinon_1.assert.calledWith(next,sinon_1.match.has(&#x27;message&#x27;,&#x27;Username or email is invalid&#x27;));cov_h1ok71qyf().s[69]++;sinon_1.assert.calledWith(next,sinon_1.match.has(&#x27;statusCode&#x27;,400));cov_h1ok71qyf().s[70]++;done();}));cov_h1ok71qyf().s[71]++;login_controller_1.default(requestStub,responseStub,next);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;95a794a6-c5bd-4e48-ab7a-ecb35ef09c09&quot;,&quot;parentUUID&quot;:&quot;74de23fc-08eb-40d1-bc93-2b9a51ba652a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;if database can&#x27;t find user&quot;,&quot;fullTitle&quot;:&quot;LoginController throws error if database can&#x27;t find user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_h1ok71qyf().f[11]++;const requestBody=(cov_h1ok71qyf().s[73]++,{username:&#x27;demo&#x27;,email:&#x27;demo@mail.com&#x27;,password:&#x27;123456&#x27;});// Stub bcrypt comparing\nconst compareStub=(cov_h1ok71qyf().s[74]++,sandbox.stub(bcrypt_1.default,&#x27;compare&#x27;));// Stub database\nconst findOneStub=(cov_h1ok71qyf().s[75]++,sandbox.stub(user_1.default,&#x27;findOne&#x27;));cov_h1ok71qyf().s[76]++;findOneStub.usingPromise(bluebird_1.default).resolves(null);// Stub express\nconst requestStub=(cov_h1ok71qyf().s[77]++,sandbox.stub());cov_h1ok71qyf().s[78]++;requestStub.body=requestBody;const responseStub=(cov_h1ok71qyf().s[79]++,sandbox.stub());cov_h1ok71qyf().s[80]++;responseStub.send=sinon_1.stub();const next=(cov_h1ok71qyf().s[81]++,sinon_1.fake(()=&gt;{cov_h1ok71qyf().f[12]++;cov_h1ok71qyf().s[82]++;sinon_1.assert.notCalled(responseStub.send);cov_h1ok71qyf().s[83]++;sinon_1.assert.notCalled(compareStub);cov_h1ok71qyf().s[84]++;sinon_1.assert.calledWith(findOneStub,sinon_1.match({where:{username:requestBody.username}}));cov_h1ok71qyf().s[85]++;sinon_1.assert.calledWith(next,sinon_1.match.hasNested(&#x27;constructor.name&#x27;,&#x27;InvalidLoginError&#x27;));cov_h1ok71qyf().s[86]++;sinon_1.assert.calledWith(next,sinon_1.match.has(&#x27;message&#x27;,&#x27;Username or email is invalid&#x27;));cov_h1ok71qyf().s[87]++;sinon_1.assert.calledWith(next,sinon_1.match.has(&#x27;statusCode&#x27;,400));cov_h1ok71qyf().s[88]++;done();}));cov_h1ok71qyf().s[89]++;login_controller_1.default(requestStub,responseStub,next);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d30df2fd-11b0-4eb4-92d8-aa3256e2d4ba&quot;,&quot;parentUUID&quot;:&quot;74de23fc-08eb-40d1-bc93-2b9a51ba652a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d2eec959-8538-4132-830c-b19c85bda5a5&quot;,&quot;95a794a6-c5bd-4e48-ab7a-ecb35ef09c09&quot;,&quot;d30df2fd-11b0-4eb4-92d8-aa3256e2d4ba&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:11,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[&quot;3ba68dd8-577f-4543-93b0-abc6e2fabd2b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8d15803c-658a-4eec-8f95-49f79bde94c5&quot;,&quot;title&quot;:&quot;LoginRouter&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\auth\\login\\login-router.integration.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\auth\\login\\login-router.integration.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;LoginRouter \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_82vozmil3().f[3]++;const csrfHeaderName=(cov_82vozmil3().s[22]++,config_1.default.jwt.securityOptions.tokenName.toLowerCase());cov_82vozmil3().s[23]++;jwt=&#x27;FAIL&#x27;;// Get csrf token\ncov_82vozmil3().s[24]++;csrf=await supertest_1.default(app_1.default).head(&#x27;/auth&#x27;).then(response=&gt;{cov_82vozmil3().f[4]++;cov_82vozmil3().s[25]++;// Save jwt cookie\njwt=response.header[&#x27;set-cookie&#x27;].pop().split(&#x27;;&#x27;)[0];cov_82vozmil3().s[26]++;return response.header[csrfHeaderName];});cov_82vozmil3().s[27]++;await db_1.syncPromise;cov_82vozmil3().s[28]++;return db_1.default.sync({force:true});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;71c5ba6c-2705-4782-bec9-8956a3a8e328&quot;,&quot;parentUUID&quot;:&quot;8d15803c-658a-4eec-8f95-49f79bde94c5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;logs in, if user exists and password is correct&quot;,&quot;fullTitle&quot;:&quot;LoginRouter logs in, if user exists and password is correct&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_82vozmil3().f[11]++;const userData=(cov_82vozmil3().s[45]++,{username:&#x27;test&#x27;,email:&#x27;test@mail.com&#x27;,password:&#x27;testPassword&#x27;});const loginBody=(cov_82vozmil3().s[46]++,{username:&#x27;test&#x27;,password:&#x27;testPassword&#x27;});// Create user in database\ncov_82vozmil3().s[47]++;await user_1.default.create(userData);cov_82vozmil3().s[48]++;await supertest_1.default(app_1.default).put(&#x27;/auth/login&#x27;).set(csrfHeaderName,csrf).set(&#x27;Cookie&#x27;,[jwt]).send(loginBody).expect(200).then(response=&gt;{cov_82vozmil3().f[12]++;cov_82vozmil3().s[49]++;chai_1.expect(response.body).to.have.property(&#x27;username&#x27;,userData.username);cov_82vozmil3().s[50]++;chai_1.expect(response.body).to.have.property(&#x27;email&#x27;,userData.email);cov_82vozmil3().s[51]++;chai_1.expect(response.body).to.have.property(&#x27;createdAt&#x27;);cov_82vozmil3().s[52]++;chai_1.expect(response.body).to.have.property(&#x27;updatedAt&#x27;);cov_82vozmil3().s[53]++;chai_1.expect(response.body).to.not.have.property(&#x27;password&#x27;);});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8abceed4-9693-42a4-81b6-065e6bcd73f0&quot;,&quot;parentUUID&quot;:&quot;8d15803c-658a-4eec-8f95-49f79bde94c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6ab53a4d-df06-400d-bc7f-95186cdc9a45&quot;,&quot;title&quot;:&quot;responses with 400&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\auth\\login\\login-router.integration.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\auth\\login\\login-router.integration.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;if no username and password given&quot;,&quot;fullTitle&quot;:&quot;LoginRouter responses with 400 if no username and password given&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_82vozmil3().f[6]++;cov_82vozmil3().s[31]++;return supertest_1.default(app_1.default).put(&#x27;/auth/login&#x27;).set(csrfHeaderName,csrf).set(&#x27;Cookie&#x27;,[jwt]).expect(400);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b96354d1-4422-48d5-b74c-8689ebd2b13a&quot;,&quot;parentUUID&quot;:&quot;6ab53a4d-df06-400d-bc7f-95186cdc9a45&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;if user doesn&#x27;t exist&quot;,&quot;fullTitle&quot;:&quot;LoginRouter responses with 400 if user doesn&#x27;t exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_82vozmil3().f[7]++;const body=(cov_82vozmil3().s[33]++,{username:&#x27;demo&#x27;,password:&#x27;password&#x27;});cov_82vozmil3().s[34]++;return supertest_1.default(app_1.default).put(&#x27;/auth/login&#x27;).set(csrfHeaderName,csrf).set(&#x27;Cookie&#x27;,[jwt]).send(body).expect(400).then(response=&gt;{cov_82vozmil3().f[8]++;cov_82vozmil3().s[35]++;chai_1.expect(response.body).to.have.property(&#x27;message&#x27;,&#x27;Username or email is invalid&#x27;);cov_82vozmil3().s[36]++;chai_1.expect(response.body).to.have.property(&#x27;statusCode&#x27;,400);});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;616bf76a-568d-4b77-8e61-613918d38521&quot;,&quot;parentUUID&quot;:&quot;6ab53a4d-df06-400d-bc7f-95186cdc9a45&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;if password is wrong&quot;,&quot;fullTitle&quot;:&quot;LoginRouter responses with 400 if password is wrong&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_82vozmil3().f[9]++;const userData=(cov_82vozmil3().s[38]++,{username:&#x27;test&#x27;,email:&#x27;test@mail.com&#x27;,password:&#x27;testPassword&#x27;});const loginBody=(cov_82vozmil3().s[39]++,{username:&#x27;test&#x27;,password:&#x27;wrong password&#x27;});// Create user in database\ncov_82vozmil3().s[40]++;await user_1.default.create(userData);cov_82vozmil3().s[41]++;await supertest_1.default(app_1.default).put(&#x27;/auth/login&#x27;).send(loginBody).set(csrfHeaderName,csrf).set(&#x27;Cookie&#x27;,[jwt]).expect(400).then(response=&gt;{cov_82vozmil3().f[10]++;cov_82vozmil3().s[42]++;chai_1.expect(response.body).to.have.property(&#x27;message&#x27;,&#x27;Username or email is invalid&#x27;);cov_82vozmil3().s[43]++;chai_1.expect(response.body).to.have.property(&#x27;statusCode&#x27;,400);});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f1111c0d-1cb5-44e6-9ef6-2ed9a7d55654&quot;,&quot;parentUUID&quot;:&quot;6ab53a4d-df06-400d-bc7f-95186cdc9a45&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b96354d1-4422-48d5-b74c-8689ebd2b13a&quot;,&quot;616bf76a-568d-4b77-8e61-613918d38521&quot;,&quot;f1111c0d-1cb5-44e6-9ef6-2ed9a7d55654&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[&quot;8abceed4-9693-42a4-81b6-065e6bcd73f0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:48,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;16ed0fac-109d-4af2-828d-179150cbe73f&quot;,&quot;title&quot;:&quot;LoginRouter&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\auth\\login\\login-router.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\auth\\login\\login-router.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;LoginRouter \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_1ln8b5ime6().f[3]++;cov_1ln8b5ime6().s[23]++;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;910cde2a-6ee3-4dcf-ade3-20da5eb597fe&quot;,&quot;parentUUID&quot;:&quot;16ed0fac-109d-4af2-828d-179150cbe73f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;calls next if no validation errors occurred&quot;,&quot;fullTitle&quot;:&quot;LoginRouter calls next if no validation errors occurred&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_1ln8b5ime6().f[4]++;const requestStub=(cov_1ln8b5ime6().s[25]++,sandbox.stub());cov_1ln8b5ime6().s[26]++;requestStub.body={username:&#x27;test&#x27;};cov_1ln8b5ime6().s[27]++;requestStub.ip=&#x27;TEST IP&#x27;;const responseStub=(cov_1ln8b5ime6().s[28]++,sandbox.stub());const nextFake=(cov_1ln8b5ime6().s[29]++,sinon_1.fake());// Mock validation results\nconst result=(cov_1ln8b5ime6().s[30]++,sandbox.createStubInstance(express_validator_1.Result));cov_1ln8b5ime6().s[31]++;result.isEmpty.returns(true);// Stub validationResult\nconst validationResultStub=(cov_1ln8b5ime6().s[32]++,sandbox.stub(validator,&#x27;validationResult&#x27;));cov_1ln8b5ime6().s[33]++;validationResultStub.withArgs(requestStub).returns(result);cov_1ln8b5ime6().s[34]++;login_router_1.loginRouter(requestStub,responseStub,nextFake);cov_1ln8b5ime6().s[35]++;sinon_1.assert.calledOnce(nextFake);cov_1ln8b5ime6().s[36]++;sandbox.assert.calledOnce(validationResultStub);cov_1ln8b5ime6().s[37]++;sandbox.assert.calledOnce(result.isEmpty);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7cfc432d-f4bc-4104-88fa-e9eb63f925d0&quot;,&quot;parentUUID&quot;:&quot;16ed0fac-109d-4af2-828d-179150cbe73f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;throws InvalidRequestError if validation errors occurred&quot;,&quot;fullTitle&quot;:&quot;LoginRouter throws InvalidRequestError if validation errors occurred&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_1ln8b5ime6().f[5]++;const requestStub=(cov_1ln8b5ime6().s[39]++,sandbox.stub());cov_1ln8b5ime6().s[40]++;requestStub.body={username:&#x27;test&#x27;};cov_1ln8b5ime6().s[41]++;requestStub.ip=&#x27;TEST IP&#x27;;const responseStub=(cov_1ln8b5ime6().s[42]++,sandbox.stub());const nextFake=(cov_1ln8b5ime6().s[43]++,sinon_1.fake());// Mock validation results\nconst result=(cov_1ln8b5ime6().s[44]++,sandbox.createStubInstance(express_validator_1.Result));cov_1ln8b5ime6().s[45]++;result.isEmpty.returns(false);const resultArray=(cov_1ln8b5ime6().s[46]++,[{param:&#x27;first param&#x27;,msg:&#x27;first msg&#x27;},{param:&#x27;second param&#x27;,msg:&#x27;second msg&#x27;}]);cov_1ln8b5ime6().s[47]++;result.array.returns(resultArray);const expectedErrorMessage=(cov_1ln8b5ime6().s[48]++,&#x27;The following fields are invalid: &#x27;+`${resultArray[0].param} -&gt; ${resultArray[0].msg}, `+`${resultArray[1].param} -&gt; ${resultArray[1].msg}`);// Stub validationResult\nconst validationResultStub=(cov_1ln8b5ime6().s[49]++,sandbox.stub(validator,&#x27;validationResult&#x27;));cov_1ln8b5ime6().s[50]++;validationResultStub.withArgs(requestStub).returns(result);cov_1ln8b5ime6().s[51]++;chai_1.expect(()=&gt;{cov_1ln8b5ime6().f[6]++;cov_1ln8b5ime6().s[52]++;return login_router_1.loginRouter(requestStub,responseStub,nextFake);}).to.throw(errors_1.InvalidRequestError,expectedErrorMessage).with.property(&#x27;validationResult&#x27;,result);cov_1ln8b5ime6().s[53]++;sinon_1.assert.notCalled(nextFake);cov_1ln8b5ime6().s[54]++;sandbox.assert.calledOnce(validationResultStub);cov_1ln8b5ime6().s[55]++;sandbox.assert.called(result.isEmpty);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5563307b-02ca-44ec-9f0c-570d0c192595&quot;,&quot;parentUUID&quot;:&quot;16ed0fac-109d-4af2-828d-179150cbe73f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7cfc432d-f4bc-4104-88fa-e9eb63f925d0&quot;,&quot;5563307b-02ca-44ec-9f0c-570d0c192595&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:6,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;18b225a2-dc62-4e41-ab35-1d839d015140&quot;,&quot;title&quot;:&quot;SignUpController&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\auth\\signUp\\sign-up-controller.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\auth\\signUp\\sign-up-controller.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;SignUpController \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_17rd9lnwas().f[3]++;cov_17rd9lnwas().s[24]++;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;df22d0b2-0f9d-4a14-9edb-1816929992a0&quot;,&quot;parentUUID&quot;:&quot;18b225a2-dc62-4e41-ab35-1d839d015140&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;creates user&quot;,&quot;fullTitle&quot;:&quot;SignUpController creates user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_17rd9lnwas().f[4]++;// Create fake user\nconst user=(cov_17rd9lnwas().s[26]++,{username:&#x27;demo&#x27;,email:&#x27;demo@mail.com&#x27;,password:&#x27;password&#x27;,isBetaUser:false,get(){cov_17rd9lnwas().f[5]++;cov_17rd9lnwas().s[27]++;return this;}});const jwt=(cov_17rd9lnwas().s[28]++,{isBetaUser:user.isBetaUser,username:user.username});// Creates stubs\nconst createStub=(cov_17rd9lnwas().s[29]++,sandbox.stub(User.default,&#x27;create&#x27;));cov_17rd9lnwas().s[30]++;createStub.usingPromise(bluebird_1.default.Promise).resolves(user);const requestStub=(cov_17rd9lnwas().s[31]++,sandbox.stub());cov_17rd9lnwas().s[32]++;requestStub.body=user;const responseStub=(cov_17rd9lnwas().s[33]++,sandbox.stub());cov_17rd9lnwas().s[34]++;responseStub.status=sandbox.stub().withArgs(201).returns(responseStub);cov_17rd9lnwas().s[35]++;responseStub.setJwtToken=sinon_1.fake();cov_17rd9lnwas().s[36]++;responseStub.send=sinon_1.fake(()=&gt;{cov_17rd9lnwas().f[6]++;cov_17rd9lnwas().s[37]++;chai_1.expect(responseStub.send.called);cov_17rd9lnwas().s[38]++;sinon_1.assert.notCalled(fakeNext);cov_17rd9lnwas().s[39]++;sandbox.assert.calledWith(responseStub.send,sinon_1.match.instanceOf(user_dto_1.default));cov_17rd9lnwas().s[40]++;sandbox.assert.calledWith(responseStub.status,201);cov_17rd9lnwas().s[41]++;sandbox.assert.calledOnce(responseStub.setJwtToken);cov_17rd9lnwas().s[42]++;sandbox.assert.calledWith(responseStub.setJwtToken,sinon_1.match(jwt));// Get user object\nconst responseUser=(cov_17rd9lnwas().s[43]++,responseStub.send.args[0][0]);cov_17rd9lnwas().s[44]++;chai_1.expect(responseUser.username).to.equal(user.username);cov_17rd9lnwas().s[45]++;chai_1.expect(responseUser.email).to.equal(user.email);cov_17rd9lnwas().s[46]++;chai_1.expect(responseUser.password).to.be.undefined;cov_17rd9lnwas().s[47]++;done();});const fakeNext=(cov_17rd9lnwas().s[48]++,sinon_1.fake());cov_17rd9lnwas().s[49]++;sign_up_controller_1.default(requestStub,responseStub,fakeNext);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7e23760f-ccf0-4564-b39b-6f8b6db48a9a&quot;,&quot;parentUUID&quot;:&quot;18b225a2-dc62-4e41-ab35-1d839d015140&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;fails to create user because username already exists&quot;,&quot;fullTitle&quot;:&quot;SignUpController fails to create user because username already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_17rd9lnwas().f[7]++;const user=(cov_17rd9lnwas().s[51]++,{username:&#x27;demo&#x27;,email:&#x27;demo@mail.com&#x27;,password:&#x27;password&#x27;,get(){cov_17rd9lnwas().f[8]++;cov_17rd9lnwas().s[52]++;return this;}});// Create stubs\nconst createStub=(cov_17rd9lnwas().s[53]++,sandbox.stub(User.default,&#x27;create&#x27;));cov_17rd9lnwas().s[54]++;createStub.usingPromise(bluebird_1.default.Promise).rejects(new sequelize_1.UniqueConstraintError());const requestStub=(cov_17rd9lnwas().s[55]++,sandbox.stub());const responseStub=(cov_17rd9lnwas().s[56]++,sandbox.stub());cov_17rd9lnwas().s[57]++;requestStub.body=user;const nextFake=(cov_17rd9lnwas().s[58]++,sinon_1.fake(err=&gt;{cov_17rd9lnwas().f[9]++;cov_17rd9lnwas().s[59]++;chai_1.expect(err).to.be.instanceOf(username_already_exists_error_1.default);cov_17rd9lnwas().s[60]++;chai_1.expect(err).to.haveOwnProperty(&#x27;username&#x27;);cov_17rd9lnwas().s[61]++;chai_1.expect(err.username).to.equal(user.username);cov_17rd9lnwas().s[62]++;done();}));cov_17rd9lnwas().s[63]++;sign_up_controller_1.default(requestStub,responseStub,nextFake);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cc2b5666-bcb5-491d-a204-cf75cb790692&quot;,&quot;parentUUID&quot;:&quot;18b225a2-dc62-4e41-ab35-1d839d015140&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;fails to create user due to some error&quot;,&quot;fullTitle&quot;:&quot;SignUpController fails to create user due to some error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_17rd9lnwas().f[10]++;// Fake user\nconst user=(cov_17rd9lnwas().s[65]++,{username:&#x27;demo&#x27;,email:&#x27;demo@mail.com&#x27;,password:&#x27;password&#x27;,get(){cov_17rd9lnwas().f[11]++;cov_17rd9lnwas().s[66]++;return this;}});// Fake error\nconst error=(cov_17rd9lnwas().s[67]++,new Error(&#x27;CUSTOM ERROR&#x27;));// Create stubs\nconst createStub=(cov_17rd9lnwas().s[68]++,sandbox.stub(User.default,&#x27;create&#x27;));cov_17rd9lnwas().s[69]++;createStub.usingPromise(bluebird_1.default.Promise).rejects(error);const requestStub=(cov_17rd9lnwas().s[70]++,sandbox.stub());const responseStub=(cov_17rd9lnwas().s[71]++,sandbox.stub());cov_17rd9lnwas().s[72]++;requestStub.body=user;const nextFake=(cov_17rd9lnwas().s[73]++,sinon_1.fake(err=&gt;{cov_17rd9lnwas().f[12]++;cov_17rd9lnwas().s[74]++;chai_1.expect(err).to.be.equal(error);cov_17rd9lnwas().s[75]++;done();}));cov_17rd9lnwas().s[76]++;sign_up_controller_1.default(requestStub,responseStub,nextFake);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d6a19577-f5f0-41ba-ac7a-9680df6c0a41&quot;,&quot;parentUUID&quot;:&quot;18b225a2-dc62-4e41-ab35-1d839d015140&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7e23760f-ccf0-4564-b39b-6f8b6db48a9a&quot;,&quot;cc2b5666-bcb5-491d-a204-cf75cb790692&quot;,&quot;d6a19577-f5f0-41ba-ac7a-9680df6c0a41&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8c27bca2-dca3-4c03-ad14-0f46a95f92a7&quot;,&quot;title&quot;:&quot;SignUpRouter&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\auth\\signUp\\sign-up-router.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\auth\\signUp\\sign-up-router.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;SignUpRouter \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_feqeulxi2().f[2]++;cov_feqeulxi2().s[19]++;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d2cf928c-de13-4569-b84f-261a585962a6&quot;,&quot;parentUUID&quot;:&quot;8c27bca2-dca3-4c03-ad14-0f46a95f92a7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;calls next if request valid&quot;,&quot;fullTitle&quot;:&quot;SignUpRouter calls next if request valid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_feqeulxi2().f[3]++;// Create stubs\nconst requestStub=(cov_feqeulxi2().s[21]++,sandbox.stub());cov_feqeulxi2().s[22]++;requestStub.ip=&#x27;TEST IP&#x27;;const responseStub=(cov_feqeulxi2().s[23]++,sandbox.stub());const nextFake=(cov_feqeulxi2().s[24]++,sinon_1.fake());// Creates fake validation result\nconst validationErrors=(cov_feqeulxi2().s[25]++,sinon_1.default.createStubInstance(validator.Result));cov_feqeulxi2().s[26]++;validationErrors.isEmpty.returns(true);// Stub validator\nconst validationResultStub=(cov_feqeulxi2().s[27]++,sandbox.stub(validator,&#x27;validationResult&#x27;));cov_feqeulxi2().s[28]++;validationResultStub.withArgs(requestStub).returns(validationErrors);cov_feqeulxi2().s[29]++;sign_up_router_1.signUpRouter(requestStub,responseStub,nextFake);cov_feqeulxi2().s[30]++;sinon_1.assert.calledOnce(nextFake);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a27c21ba-a81c-47f4-a672-35389de63b2e&quot;,&quot;parentUUID&quot;:&quot;8c27bca2-dca3-4c03-ad14-0f46a95f92a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;throws InvalidRequestError if request invalid&quot;,&quot;fullTitle&quot;:&quot;SignUpRouter throws InvalidRequestError if request invalid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_feqeulxi2().f[4]++;// Create stubs\nconst requestStub=(cov_feqeulxi2().s[32]++,sandbox.stub());cov_feqeulxi2().s[33]++;requestStub.ip=&#x27;TEST IP&#x27;;const responseStub=(cov_feqeulxi2().s[34]++,sandbox.stub());const nextFake=(cov_feqeulxi2().s[35]++,sinon_1.fake());// Creates fake validation result\nconst validationErrors=(cov_feqeulxi2().s[36]++,sinon_1.default.createStubInstance(validator.Result));cov_feqeulxi2().s[37]++;validationErrors.isEmpty.returns(false);const errorArray=(cov_feqeulxi2().s[38]++,[{param:&#x27;first param&#x27;,msg:&#x27;first reason&#x27;},{param:&#x27;second param&#x27;,msg:&#x27;second reason&#x27;}]);cov_feqeulxi2().s[39]++;validationErrors.array.returns(errorArray);// Stub validator\nconst validationResultStub=(cov_feqeulxi2().s[40]++,sandbox.stub(validator,&#x27;validationResult&#x27;));cov_feqeulxi2().s[41]++;validationResultStub.withArgs(requestStub).returns(validationErrors);const expectedMessage=(cov_feqeulxi2().s[42]++,&#x27;The following fields are invalid: &#x27;+`${errorArray[0].param} -&gt; ${errorArray[0].msg}, `+`${errorArray[1].param} -&gt; ${errorArray[1].msg}`);cov_feqeulxi2().s[43]++;chai_1.expect(()=&gt;{cov_feqeulxi2().f[5]++;cov_feqeulxi2().s[44]++;return sign_up_router_1.signUpRouter(requestStub,responseStub,nextFake);}).to.throw(errors_1.InvalidRequestError,expectedMessage).with.property(&#x27;validationResult&#x27;,validationErrors);cov_feqeulxi2().s[45]++;sinon_1.assert.notCalled(nextFake);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;15a065a5-837b-4ead-8655-4208a1ed8608&quot;,&quot;parentUUID&quot;:&quot;8c27bca2-dca3-4c03-ad14-0f46a95f92a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a27c21ba-a81c-47f4-a672-35389de63b2e&quot;,&quot;15a065a5-837b-4ead-8655-4208a1ed8608&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f76c44c3-79c8-4f9d-8643-8b71fd5fe069&quot;,&quot;title&quot;:&quot;SignUpRouter&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\auth\\signUp\\sign-up.integration.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\auth\\signUp\\sign-up.integration.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;SignUpRouter \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_12j8vw84ob().f[2]++;const csrfHeaderName=(cov_12j8vw84ob().s[11]++,config_1.default.jwt.securityOptions.tokenName.toLowerCase());cov_12j8vw84ob().s[12]++;jwt=&#x27;FAIL&#x27;;// Get csrf token\ncov_12j8vw84ob().s[13]++;csrf=await supertest_1.default(app_1.default).head(&#x27;/auth&#x27;).then(response=&gt;{cov_12j8vw84ob().f[3]++;cov_12j8vw84ob().s[14]++;// Save jwt cookie\njwt=response.header[&#x27;set-cookie&#x27;].pop().split(&#x27;;&#x27;)[0];cov_12j8vw84ob().s[15]++;return response.header[csrfHeaderName];});cov_12j8vw84ob().s[16]++;return db_1.syncPromise;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4dd477dd-1ba8-466d-9597-59f73c171435&quot;,&quot;parentUUID&quot;:&quot;f76c44c3-79c8-4f9d-8643-8b71fd5fe069&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;creates new user&quot;,&quot;fullTitle&quot;:&quot;SignUpRouter creates new user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_12j8vw84ob().f[15]++;const body=(cov_12j8vw84ob().s[54]++,{username:&#x27;demo&#x27;,password:&#x27;123456&#x27;,email:&#x27;demo@mail.com&#x27;});cov_12j8vw84ob().s[55]++;return supertest_1.default(app_1.default).put(&#x27;/auth/sign-up&#x27;).set(&#x27;Cookie&#x27;,[jwt]).set(csrfHeaderName,csrf).send(body).expect(201).then(response=&gt;{cov_12j8vw84ob().f[16]++;cov_12j8vw84ob().s[56]++;chai_1.expect(response.body).to.have.property(&#x27;username&#x27;,body.username);cov_12j8vw84ob().s[57]++;chai_1.expect(response.body).to.have.property(&#x27;email&#x27;,body.email);cov_12j8vw84ob().s[58]++;chai_1.expect(response.body).to.have.not.property(&#x27;password&#x27;);cov_12j8vw84ob().s[59]++;chai_1.expect(response.body).to.have.property(&#x27;createdAt&#x27;);cov_12j8vw84ob().s[60]++;chai_1.expect(response.body).to.have.property(&#x27;updatedAt&#x27;);cov_12j8vw84ob().s[61]++;chai_1.expect(response.body).to.have.property(&#x27;deletedAt&#x27;);});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6617bd53-275c-4c0f-a3e8-1ef043d0669f&quot;,&quot;parentUUID&quot;:&quot;f76c44c3-79c8-4f9d-8643-8b71fd5fe069&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e17b8472-773c-4967-9986-1f0012afbe8f&quot;,&quot;title&quot;:&quot;returns 400 if&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\auth\\signUp\\sign-up.integration.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\auth\\signUp\\sign-up.integration.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;request is missing username&quot;,&quot;fullTitle&quot;:&quot;SignUpRouter returns 400 if request is missing username&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_12j8vw84ob().f[5]++;const body=(cov_12j8vw84ob().s[19]++,{password:&#x27;password&#x27;,email:&#x27;demo@mail.com&#x27;});cov_12j8vw84ob().s[20]++;return supertest_1.default(app_1.default).put(&#x27;/auth/sign-up&#x27;).set(&#x27;Cookie&#x27;,[jwt]).set(csrfHeaderName,csrf).send(body).expect(400).then(response=&gt;{cov_12j8vw84ob().f[6]++;cov_12j8vw84ob().s[21]++;chai_1.expect(response.body).to.have.property(&#x27;statusCode&#x27;,400);cov_12j8vw84ob().s[22]++;chai_1.expect(response.body).to.have.property(&#x27;status&#x27;);cov_12j8vw84ob().s[23]++;chai_1.expect(response.body).to.have.property(&#x27;message&#x27;);cov_12j8vw84ob().s[24]++;chai_1.expect(response.body).to.have.property(&#x27;timestamp&#x27;);});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9d58052f-49bd-4f1d-bbe2-37cbd37e29ea&quot;,&quot;parentUUID&quot;:&quot;e17b8472-773c-4967-9986-1f0012afbe8f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;request is missing password&quot;,&quot;fullTitle&quot;:&quot;SignUpRouter returns 400 if request is missing password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_12j8vw84ob().f[7]++;const body=(cov_12j8vw84ob().s[26]++,{username:&#x27;demo&#x27;,email:&#x27;demo@mail.com&#x27;});cov_12j8vw84ob().s[27]++;return supertest_1.default(app_1.default).put(&#x27;/auth/sign-up&#x27;).set(&#x27;Cookie&#x27;,[jwt]).set(csrfHeaderName,csrf).send(body).expect(400).then(response=&gt;{cov_12j8vw84ob().f[8]++;cov_12j8vw84ob().s[28]++;chai_1.expect(response.body).to.have.property(&#x27;statusCode&#x27;,400);cov_12j8vw84ob().s[29]++;chai_1.expect(response.body).to.have.property(&#x27;status&#x27;);cov_12j8vw84ob().s[30]++;chai_1.expect(response.body).to.have.property(&#x27;message&#x27;);cov_12j8vw84ob().s[31]++;chai_1.expect(response.body).to.have.property(&#x27;timestamp&#x27;);});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;36418039-4887-4fa7-bb65-de8d39ecc65d&quot;,&quot;parentUUID&quot;:&quot;e17b8472-773c-4967-9986-1f0012afbe8f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;password is shorter than 6 characters&quot;,&quot;fullTitle&quot;:&quot;SignUpRouter returns 400 if password is shorter than 6 characters&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_12j8vw84ob().f[9]++;const body=(cov_12j8vw84ob().s[33]++,{username:&#x27;demo&#x27;,password:&#x27;12345&#x27;,email:&#x27;demo@mail.com&#x27;});cov_12j8vw84ob().s[34]++;return supertest_1.default(app_1.default).put(&#x27;/auth/sign-up&#x27;).set(&#x27;Cookie&#x27;,[jwt]).set(csrfHeaderName,csrf).send(body).expect(400).then(response=&gt;{cov_12j8vw84ob().f[10]++;cov_12j8vw84ob().s[35]++;chai_1.expect(response.body).to.have.property(&#x27;statusCode&#x27;,400);cov_12j8vw84ob().s[36]++;chai_1.expect(response.body).to.have.property(&#x27;status&#x27;);cov_12j8vw84ob().s[37]++;chai_1.expect(response.body).to.have.property(&#x27;message&#x27;);cov_12j8vw84ob().s[38]++;chai_1.expect(response.body).to.have.property(&#x27;timestamp&#x27;);});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fd9c1c9d-4587-4438-ad30-0be2710dc06d&quot;,&quot;parentUUID&quot;:&quot;e17b8472-773c-4967-9986-1f0012afbe8f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;request is missing email&quot;,&quot;fullTitle&quot;:&quot;SignUpRouter returns 400 if request is missing email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_12j8vw84ob().f[11]++;const body=(cov_12j8vw84ob().s[40]++,{password:&#x27;password&#x27;,username:&#x27;demo&#x27;});cov_12j8vw84ob().s[41]++;return supertest_1.default(app_1.default).put(&#x27;/auth/sign-up&#x27;).set(&#x27;Cookie&#x27;,[jwt]).set(csrfHeaderName,csrf).send(body).expect(400).then(response=&gt;{cov_12j8vw84ob().f[12]++;cov_12j8vw84ob().s[42]++;chai_1.expect(response.body).to.have.property(&#x27;statusCode&#x27;,400);cov_12j8vw84ob().s[43]++;chai_1.expect(response.body).to.have.property(&#x27;status&#x27;);cov_12j8vw84ob().s[44]++;chai_1.expect(response.body).to.have.property(&#x27;message&#x27;);cov_12j8vw84ob().s[45]++;chai_1.expect(response.body).to.have.property(&#x27;timestamp&#x27;);});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;37d59a10-6959-47bd-8d78-47e07caa67f8&quot;,&quot;parentUUID&quot;:&quot;e17b8472-773c-4967-9986-1f0012afbe8f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;email property is not a valid email&quot;,&quot;fullTitle&quot;:&quot;SignUpRouter returns 400 if email property is not a valid email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_12j8vw84ob().f[13]++;const body=(cov_12j8vw84ob().s[47]++,{username:&#x27;demo&#x27;,password:&#x27;12345&#x27;,email:&#x27;demo&#x27;});cov_12j8vw84ob().s[48]++;return supertest_1.default(app_1.default).put(&#x27;/auth/sign-up&#x27;).set(&#x27;Cookie&#x27;,[jwt]).set(csrfHeaderName,csrf).send(body).expect(400).then(response=&gt;{cov_12j8vw84ob().f[14]++;cov_12j8vw84ob().s[49]++;chai_1.expect(response.body).to.have.property(&#x27;statusCode&#x27;,400);cov_12j8vw84ob().s[50]++;chai_1.expect(response.body).to.have.property(&#x27;status&#x27;);cov_12j8vw84ob().s[51]++;chai_1.expect(response.body).to.have.property(&#x27;message&#x27;);cov_12j8vw84ob().s[52]++;chai_1.expect(response.body).to.have.property(&#x27;timestamp&#x27;);});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;46b5af46-57eb-4ab8-9f26-3aa25f69a8ff&quot;,&quot;parentUUID&quot;:&quot;e17b8472-773c-4967-9986-1f0012afbe8f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9d58052f-49bd-4f1d-bbe2-37cbd37e29ea&quot;,&quot;36418039-4887-4fa7-bb65-de8d39ecc65d&quot;,&quot;fd9c1c9d-4587-4438-ad30-0be2710dc06d&quot;,&quot;37d59a10-6959-47bd-8d78-47e07caa67f8&quot;,&quot;46b5af46-57eb-4ab8-9f26-3aa25f69a8ff&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[&quot;6617bd53-275c-4c0f-a3e8-1ef043d0669f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c2d63ee0-1ecd-4911-9cd6-2e66b05a912a&quot;,&quot;title&quot;:&quot;ErrorHandler&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\errors\\error-handler.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\errors\\error-handler.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;ErrorHandler \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_mn39xzspr().f[3]++;cov_mn39xzspr().s[23]++;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bd9764d4-d635-4fa7-a90e-98fddccc2d05&quot;,&quot;parentUUID&quot;:&quot;c2d63ee0-1ecd-4911-9cd6-2e66b05a912a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;throws specific Error if instanceof RestError&quot;,&quot;fullTitle&quot;:&quot;ErrorHandler throws specific Error if instanceof RestError&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_mn39xzspr().f[4]++;// Spy and stub\nconst responseStub=(cov_mn39xzspr().s[25]++,sandbox.stub());const requestStub=(cov_mn39xzspr().s[26]++,sandbox.stub());const nextStub=(cov_mn39xzspr().s[27]++,sinon_1.default.stub());const validationResultStub=(cov_mn39xzspr().s[28]++,sandbox.createStubInstance(express_validator_1.Result));// Stub methods\ncov_mn39xzspr().s[29]++;validationResultStub.isEmpty.returns(true);cov_mn39xzspr().s[30]++;responseStub.status=sandbox.stub().returns(responseStub);cov_mn39xzspr().s[31]++;responseStub.send=sandbox.stub();// Test\nconst error=(cov_mn39xzspr().s[32]++,new invalid_request_error_1.default(validationResultStub));cov_mn39xzspr().s[33]++;error_handler_1.default(error,requestStub,responseStub,nextStub);cov_mn39xzspr().s[34]++;sandbox.assert.notCalled(requestStub);cov_mn39xzspr().s[35]++;sandbox.assert.calledOnce(validationResultStub.isEmpty);cov_mn39xzspr().s[36]++;sandbox.assert.calledOnce(responseStub.status);cov_mn39xzspr().s[37]++;sandbox.assert.calledOnce(responseStub.send);cov_mn39xzspr().s[38]++;sandbox.assert.calledWith(responseStub.send,sinon_1.match.instanceOf(rest_error_1.default));cov_mn39xzspr().s[39]++;sandbox.assert.calledWith(responseStub.send,sinon_1.match.has(&#x27;message&#x27;,error.message));cov_mn39xzspr().s[40]++;sandbox.assert.calledWith(responseStub.send,sinon_1.match.has(&#x27;timestamp&#x27;,sinon_1.match.date));cov_mn39xzspr().s[41]++;sandbox.assert.calledWith(responseStub.send,sinon_1.match.has(&#x27;statusCode&#x27;,error.statusCode));cov_mn39xzspr().s[42]++;sandbox.assert.calledWith(responseStub.send,sinon_1.match.has(&#x27;detail&#x27;,error.detail));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1a7ec7b6-2913-443a-8b36-b8875db68760&quot;,&quot;parentUUID&quot;:&quot;c2d63ee0-1ecd-4911-9cd6-2e66b05a912a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;throws InternalError if not instanceof RestError&quot;,&quot;fullTitle&quot;:&quot;ErrorHandler throws InternalError if not instanceof RestError&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_mn39xzspr().f[5]++;// Spy and stub\nconst responseStub=(cov_mn39xzspr().s[44]++,sandbox.stub());const requestStub=(cov_mn39xzspr().s[45]++,sandbox.stub());const nextStub=(cov_mn39xzspr().s[46]++,sandbox.stub());// Stub methods\ncov_mn39xzspr().s[47]++;responseStub.status=sandbox.stub().returns(responseStub);cov_mn39xzspr().s[48]++;responseStub.send=sandbox.stub();// Test\nconst error=(cov_mn39xzspr().s[49]++,new Error());const stack=(cov_mn39xzspr().s[50]++,&#x27;SOME STACK&#x27;);cov_mn39xzspr().s[51]++;error.stack=stack;cov_mn39xzspr().s[52]++;error_handler_1.default(error,requestStub,responseStub,nextStub);cov_mn39xzspr().s[53]++;sandbox.assert.notCalled(requestStub);cov_mn39xzspr().s[54]++;sandbox.assert.calledOnce(responseStub.status);cov_mn39xzspr().s[55]++;sandbox.assert.calledOnce(responseStub.send);cov_mn39xzspr().s[56]++;sandbox.assert.calledWith(responseStub.send,sinon_1.match.instanceOf(internal_error_1.default));cov_mn39xzspr().s[57]++;sandbox.assert.calledWith(responseStub.send,sinon_1.match.has(&#x27;stack&#x27;,stack));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;17aefa44-0c79-487f-bd7f-203c350e11ba&quot;,&quot;parentUUID&quot;:&quot;c2d63ee0-1ecd-4911-9cd6-2e66b05a912a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;throws InternalError without stack if environment is production&quot;,&quot;fullTitle&quot;:&quot;ErrorHandler throws InternalError without stack if environment is production&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_mn39xzspr().f[6]++;cov_mn39xzspr().s[59]++;config.default.error.withStack=false;// Spy and stub\nconst responseStub=(cov_mn39xzspr().s[60]++,sandbox.stub());const requestStub=(cov_mn39xzspr().s[61]++,sandbox.stub());const nextStub=(cov_mn39xzspr().s[62]++,sandbox.stub());// Stub methods\ncov_mn39xzspr().s[63]++;responseStub.status=sandbox.stub().returns(responseStub);cov_mn39xzspr().s[64]++;responseStub.send=sandbox.stub();// Test\nconst error=(cov_mn39xzspr().s[65]++,new Error());cov_mn39xzspr().s[66]++;error_handler_1.default(error,requestStub,responseStub,nextStub);cov_mn39xzspr().s[67]++;sandbox.assert.notCalled(requestStub);cov_mn39xzspr().s[68]++;sandbox.assert.calledOnce(responseStub.status);cov_mn39xzspr().s[69]++;sandbox.assert.calledOnce(responseStub.send);cov_mn39xzspr().s[70]++;sandbox.assert.calledWith(responseStub.send,sinon_1.match.instanceOf(internal_error_1.default));cov_mn39xzspr().s[71]++;sandbox.assert.calledWith(responseStub.send,sinon_1.match.has(&#x27;stack&#x27;,undefined));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cee1345c-f3b8-4bcc-aa43-b81ac6c37095&quot;,&quot;parentUUID&quot;:&quot;c2d63ee0-1ecd-4911-9cd6-2e66b05a912a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1a7ec7b6-2913-443a-8b36-b8875db68760&quot;,&quot;17aefa44-0c79-487f-bd7f-203c350e11ba&quot;,&quot;cee1345c-f3b8-4bcc-aa43-b81ac6c37095&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;eb70fe89-bcd8-4f4b-b576-541ad89f851c&quot;,&quot;title&quot;:&quot;jwt-util&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\jwt\\jwt-util.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\jwt\\jwt-util.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;jwt-util \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_15wj3jfxe0().f[3]++;cov_15wj3jfxe0().s[23]++;/*\n         * Stub sign function with a fake which returns the given arguments inside\n         * an object.\n         */signStub=sandbox.stub(jsonwebtoken_1.default,&#x27;sign&#x27;).callsFake((payload,secret,options)=&gt;{cov_15wj3jfxe0().f[4]++;cov_15wj3jfxe0().s[24]++;return{payload,secret,options};});/**\n         * Stub `getOptions` of the config with a fake which\n         * returns the given argument.\n         * Real implementation is not relevant here.\n         */cov_15wj3jfxe0().s[25]++;getOptionsStub=sandbox.stub(config_1.default.jwt,&#x27;getOptions&#x27;).callsFake(subject=&gt;{cov_15wj3jfxe0().f[5]++;cov_15wj3jfxe0().s[26]++;if(subject!==undefined){cov_15wj3jfxe0().b[8][0]++;cov_15wj3jfxe0().s[27]++;return subject;}else{cov_15wj3jfxe0().b[8][1]++;cov_15wj3jfxe0().s[28]++;return config_1.default.jwt.notLoggedInSubject;}});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2e21b171-ee4b-4e41-88bc-61d162c7b327&quot;,&quot;parentUUID&quot;:&quot;eb70fe89-bcd8-4f4b-b576-541ad89f851c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;jwt-util \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_15wj3jfxe0().f[6]++;cov_15wj3jfxe0().s[30]++;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1e173b2b-e1da-4a31-9759-4233e8faec1f&quot;,&quot;parentUUID&quot;:&quot;eb70fe89-bcd8-4f4b-b576-541ad89f851c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;70466c36-93b0-427a-8453-376cde8615cc&quot;,&quot;title&quot;:&quot;generateToken&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\jwt\\jwt-util.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\jwt\\jwt-util.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;db8f8690-aa71-43f6-9ae8-449a09b86680&quot;,&quot;title&quot;:&quot;generates token for user&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\jwt\\jwt-util.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\jwt\\jwt-util.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;jwt-util generateToken generates token for user \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_15wj3jfxe0().f[9]++;cov_15wj3jfxe0().s[36]++;user=user_1.default.build(userData);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ac19fc4d-dff6-4f5e-a8e6-c54d4afd7825&quot;,&quot;parentUUID&quot;:&quot;db8f8690-aa71-43f6-9ae8-449a09b86680&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;with subject&quot;,&quot;fullTitle&quot;:&quot;jwt-util generateToken generates token for user with subject&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_15wj3jfxe0().f[10]++;const subject=(cov_15wj3jfxe0().s[38]++,&#x27;subject&#x27;);const actual=(cov_15wj3jfxe0().s[39]++,jwt_util_1.generateToken(user,subject));cov_15wj3jfxe0().s[40]++;chai_1.expect(actual.payload).to.eql(expectedPayload);cov_15wj3jfxe0().s[41]++;chai_1.expect(actual.secret).to.equal(config_1.default.jwt.secret);cov_15wj3jfxe0().s[42]++;chai_1.expect(actual.options).to.equal(userData.username);cov_15wj3jfxe0().s[43]++;sandbox.assert.calledOnce(getOptionsStub);cov_15wj3jfxe0().s[44]++;sandbox.assert.calledWith(getOptionsStub,userData.username);cov_15wj3jfxe0().s[45]++;sandbox.assert.calledOnce(signStub);cov_15wj3jfxe0().s[46]++;sandbox.assert.calledWith(signStub,sinon_1.match(actual.payload),actual.secret,actual.options);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b575430d-3678-4baf-b8ee-5eddc5b9ec29&quot;,&quot;parentUUID&quot;:&quot;db8f8690-aa71-43f6-9ae8-449a09b86680&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;without subject&quot;,&quot;fullTitle&quot;:&quot;jwt-util generateToken generates token for user without subject&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_15wj3jfxe0().f[11]++;const actual=(cov_15wj3jfxe0().s[48]++,jwt_util_1.generateToken(user));cov_15wj3jfxe0().s[49]++;chai_1.expect(actual.payload).to.eql(expectedPayload);cov_15wj3jfxe0().s[50]++;chai_1.expect(actual.secret).to.equal(config_1.default.jwt.secret);cov_15wj3jfxe0().s[51]++;chai_1.expect(actual.options).to.equal(userData.username);cov_15wj3jfxe0().s[52]++;sandbox.assert.calledOnce(getOptionsStub);cov_15wj3jfxe0().s[53]++;sandbox.assert.calledWith(getOptionsStub,userData.username);cov_15wj3jfxe0().s[54]++;sandbox.assert.calledOnce(signStub);cov_15wj3jfxe0().s[55]++;sandbox.assert.calledWith(signStub,sinon_1.match(actual.payload),actual.secret,actual.options);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ae7bca24-ecc6-46bf-9f4b-2eaae250ef42&quot;,&quot;parentUUID&quot;:&quot;db8f8690-aa71-43f6-9ae8-449a09b86680&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b575430d-3678-4baf-b8ee-5eddc5b9ec29&quot;,&quot;ae7bca24-ecc6-46bf-9f4b-2eaae250ef42&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;24612c38-0b2f-47e0-a2c8-362da42fab77&quot;,&quot;title&quot;:&quot;generates token&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\jwt\\jwt-util.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\jwt\\jwt-util.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;with subject&quot;,&quot;fullTitle&quot;:&quot;jwt-util generateToken generates token with subject&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_15wj3jfxe0().f[13]++;const subject=(cov_15wj3jfxe0().s[59]++,&#x27;subject&#x27;);const actual=(cov_15wj3jfxe0().s[60]++,jwt_util_1.generateToken(payload,subject));cov_15wj3jfxe0().s[61]++;chai_1.expect(actual.payload).to.equal(payload);cov_15wj3jfxe0().s[62]++;chai_1.expect(actual.secret).to.equal(config_1.default.jwt.secret);cov_15wj3jfxe0().s[63]++;chai_1.expect(actual.options).to.equal(subject);cov_15wj3jfxe0().s[64]++;sandbox.assert.calledOnce(getOptionsStub);cov_15wj3jfxe0().s[65]++;sandbox.assert.calledWith(getOptionsStub,subject);cov_15wj3jfxe0().s[66]++;sandbox.assert.calledOnce(signStub);cov_15wj3jfxe0().s[67]++;sandbox.assert.calledWith(signStub,sinon_1.match(actual.payload),actual.secret,actual.options);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e080ccfc-8c5d-417e-b17b-c3e2a00ee900&quot;,&quot;parentUUID&quot;:&quot;24612c38-0b2f-47e0-a2c8-362da42fab77&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;without subject&quot;,&quot;fullTitle&quot;:&quot;jwt-util generateToken generates token without subject&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_15wj3jfxe0().f[14]++;const actual=(cov_15wj3jfxe0().s[69]++,jwt_util_1.generateToken(payload));cov_15wj3jfxe0().s[70]++;chai_1.expect(actual.payload).to.equal(payload);cov_15wj3jfxe0().s[71]++;chai_1.expect(actual.secret).to.equal(config_1.default.jwt.secret);cov_15wj3jfxe0().s[72]++;chai_1.expect(actual.options).to.equal(config_1.default.jwt.notLoggedInSubject);cov_15wj3jfxe0().s[73]++;sandbox.assert.calledOnce(getOptionsStub);cov_15wj3jfxe0().s[74]++;sandbox.assert.calledWith(getOptionsStub,sinon_1.match.typeOf(&#x27;undefined&#x27;));cov_15wj3jfxe0().s[75]++;sandbox.assert.calledOnce(signStub);cov_15wj3jfxe0().s[76]++;sandbox.assert.calledWith(signStub,sinon_1.match(actual.payload),actual.secret,actual.options);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1a916230-e9a5-4dd7-a6be-c41fd248123b&quot;,&quot;parentUUID&quot;:&quot;24612c38-0b2f-47e0-a2c8-362da42fab77&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e080ccfc-8c5d-417e-b17b-c3e2a00ee900&quot;,&quot;1a916230-e9a5-4dd7-a6be-c41fd248123b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c712e1ea-567a-4d40-a624-c2dd090c06bd&quot;,&quot;title&quot;:&quot;convertUserToJwtPayload&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\jwt\\jwt-util.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\jwt\\jwt-util.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;converts successfully&quot;,&quot;fullTitle&quot;:&quot;jwt-util convertUserToJwtPayload converts successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_15wj3jfxe0().f[16]++;const userData=(cov_15wj3jfxe0().s[79]++,{username:&#x27;test&#x27;,email:&#x27;test@mail.com&#x27;,password:&#x27;password&#x27;,isBetaUser:true,other:&#x27;field&#x27;});const expected=(cov_15wj3jfxe0().s[80]++,{username:userData.username,isBetaUser:userData.isBetaUser});cov_15wj3jfxe0().s[81]++;chai_1.expect(jwt_util_1.convertUserToJwtPayload(userData)).to.be.eql(expected);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fad74f16-0870-4af7-b585-34e1edb0f71d&quot;,&quot;parentUUID&quot;:&quot;c712e1ea-567a-4d40-a624-c2dd090c06bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;throws error if no argument given&quot;,&quot;fullTitle&quot;:&quot;jwt-util convertUserToJwtPayload throws error if no argument given&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_15wj3jfxe0().f[17]++;cov_15wj3jfxe0().s[83]++;chai_1.expect(()=&gt;{cov_15wj3jfxe0().f[18]++;cov_15wj3jfxe0().s[84]++;return jwt_util_1.convertUserToJwtPayload(undefined);}).to.throw(TypeError);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6e62d6c1-c4ce-4b3e-abcc-fd68bdd54d5a&quot;,&quot;parentUUID&quot;:&quot;c712e1ea-567a-4d40-a624-c2dd090c06bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fad74f16-0870-4af7-b585-34e1edb0f71d&quot;,&quot;6e62d6c1-c4ce-4b3e-abcc-fd68bdd54d5a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4d7be31d-6d32-4c00-a393-ab44ae893fed&quot;,&quot;title&quot;:&quot;preLoginJwtValidator&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\jwt\\jwt-util.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\jwt\\jwt-util.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;calls next if jwt not pre-login jwt&quot;,&quot;fullTitle&quot;:&quot;jwt-util preLoginJwtValidator calls next if jwt not pre-login jwt&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_15wj3jfxe0().f[20]++;const request=(cov_15wj3jfxe0().s[87]++,sandbox.stub());cov_15wj3jfxe0().s[88]++;request.user={sub:&#x27;subject&#x27;};const next=(cov_15wj3jfxe0().s[89]++,sandbox.stub());const response=(cov_15wj3jfxe0().s[90]++,sandbox.stub());cov_15wj3jfxe0().s[91]++;jwt_util_1.preLoginJwtValidator(request,response,next);cov_15wj3jfxe0().s[92]++;sandbox.assert.calledOnce(next);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c780d84d-bc07-40e6-9115-20fe25b1b48d&quot;,&quot;parentUUID&quot;:&quot;4d7be31d-6d32-4c00-a393-ab44ae893fed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;throws UnauthorizedError if jwt doesn&#x27;t exist on request&quot;,&quot;fullTitle&quot;:&quot;jwt-util preLoginJwtValidator throws UnauthorizedError if jwt doesn&#x27;t exist on request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_15wj3jfxe0().f[21]++;const request=(cov_15wj3jfxe0().s[94]++,sandbox.stub());const next=(cov_15wj3jfxe0().s[95]++,sandbox.stub());const response=(cov_15wj3jfxe0().s[96]++,sandbox.stub());cov_15wj3jfxe0().s[97]++;chai_1.expect(()=&gt;{cov_15wj3jfxe0().f[22]++;cov_15wj3jfxe0().s[98]++;return jwt_util_1.preLoginJwtValidator(request,response,next);}).to.throw(errors_1.UnauthorizedError);cov_15wj3jfxe0().s[99]++;sandbox.assert.notCalled(next);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6fb2752e-d895-41c8-9daa-03bfc30e4386&quot;,&quot;parentUUID&quot;:&quot;4d7be31d-6d32-4c00-a393-ab44ae893fed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;throws UnauthorizedError if subject of jwt is pre-login subject&quot;,&quot;fullTitle&quot;:&quot;jwt-util preLoginJwtValidator throws UnauthorizedError if subject of jwt is pre-login subject&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_15wj3jfxe0().f[23]++;const request=(cov_15wj3jfxe0().s[101]++,sandbox.stub());cov_15wj3jfxe0().s[102]++;request.user={sub:config_1.default.jwt.notLoggedInSubject};const next=(cov_15wj3jfxe0().s[103]++,sandbox.stub());const response=(cov_15wj3jfxe0().s[104]++,sandbox.stub());cov_15wj3jfxe0().s[105]++;chai_1.expect(()=&gt;{cov_15wj3jfxe0().f[24]++;cov_15wj3jfxe0().s[106]++;return jwt_util_1.preLoginJwtValidator(request,response,next);}).to.throw(errors_1.UnauthorizedError);cov_15wj3jfxe0().s[107]++;sandbox.assert.notCalled(next);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1f2600ba-41a7-4824-922f-74f72ccb4bb0&quot;,&quot;parentUUID&quot;:&quot;4d7be31d-6d32-4c00-a393-ab44ae893fed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c780d84d-bc07-40e6-9115-20fe25b1b48d&quot;,&quot;6fb2752e-d895-41c8-9daa-03bfc30e4386&quot;,&quot;1f2600ba-41a7-4824-922f-74f72ccb4bb0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;37d2d102-5a91-4b64-a532-f6757f8c2c64&quot;,&quot;title&quot;:&quot;User model&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\users\\user.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\users\\user.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;User model \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_2lw5onoxc1().f[3]++;cov_2lw5onoxc1().s[21]++;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0754f34e-08cc-43b7-87b7-fad1fdfbbe0c&quot;,&quot;parentUUID&quot;:&quot;37d2d102-5a91-4b64-a532-f6757f8c2c64&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7764d4b8-83fe-4f3b-956f-dd2c21d66807&quot;,&quot;title&quot;:&quot;hashPasswordOfUser&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\app\\users\\user.unit.spec.ts&quot;,&quot;file&quot;:&quot;\\app\\users\\user.unit.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can hash string&quot;,&quot;fullTitle&quot;:&quot;User model hashPasswordOfUser can hash string&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_2lw5onoxc1().f[5]++;const password=(cov_2lw5onoxc1().s[24]++,&#x27;1234&#x27;);const fakeUser=(cov_2lw5onoxc1().s[25]++,{password});// Overwrite saltRounds in config\nconst saltRounds=(cov_2lw5onoxc1().s[26]++,2);cov_2lw5onoxc1().s[27]++;config.default.bcrypt.saltRounds=saltRounds;const fakeHash=(cov_2lw5onoxc1().s[28]++,&#x27;some hash&#x27;);const hashStub=(cov_2lw5onoxc1().s[29]++,sandbox.stub(bcrypt_1.default).hash.withArgs(sinon_1.match.string,saltRounds).resolves(fakeHash));cov_2lw5onoxc1().s[30]++;return user_1.hashPasswordOfUser(fakeUser).then(()=&gt;{cov_2lw5onoxc1().f[6]++;cov_2lw5onoxc1().s[31]++;chai_1.expect(fakeUser.password).to.equal(fakeHash);cov_2lw5onoxc1().s[32]++;sinon_1.assert.calledOnce(hashStub);cov_2lw5onoxc1().s[33]++;sinon_1.assert.calledWith(hashStub,password,saltRounds);});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f0f1cc47-7ba7-4896-8c2a-03d06654aae8&quot;,&quot;parentUUID&quot;:&quot;7764d4b8-83fe-4f3b-956f-dd2c21d66807&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;can hash number&quot;,&quot;fullTitle&quot;:&quot;User model hashPasswordOfUser can hash number&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_2lw5onoxc1().f[7]++;const password=(cov_2lw5onoxc1().s[35]++,1234);const fakeUser=(cov_2lw5onoxc1().s[36]++,{password});// Overwrite saltRounds in config\nconst saltRounds=(cov_2lw5onoxc1().s[37]++,2);cov_2lw5onoxc1().s[38]++;config.default.bcrypt.saltRounds=saltRounds;const fakeHash=(cov_2lw5onoxc1().s[39]++,&#x27;some hash&#x27;);const hashStub=(cov_2lw5onoxc1().s[40]++,sandbox.stub(bcrypt_1.default).hash.withArgs(sinon_1.match.string,sinon_1.match.number).resolves(fakeHash));cov_2lw5onoxc1().s[41]++;return user_1.hashPasswordOfUser(fakeUser).then(()=&gt;{cov_2lw5onoxc1().f[8]++;cov_2lw5onoxc1().s[42]++;chai_1.expect(fakeUser.password).to.equal(fakeHash);cov_2lw5onoxc1().s[43]++;sinon_1.assert.calledOnce(hashStub);cov_2lw5onoxc1().s[44]++;sinon_1.assert.calledWith(hashStub,password.toString(),saltRounds);});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;03a60341-3559-4f8b-8c6b-15e041dd03d2&quot;,&quot;parentUUID&quot;:&quot;7764d4b8-83fe-4f3b-956f-dd2c21d66807&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;throws PasswordNotHashableError if bcrypt can&#x27;t hash&quot;,&quot;fullTitle&quot;:&quot;User model hashPasswordOfUser throws PasswordNotHashableError if bcrypt can&#x27;t hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;cov_2lw5onoxc1().f[9]++;const fakeUser=(cov_2lw5onoxc1().s[46]++,{username:&#x27;demo&#x27;,password:1234});const expectedMessage=(cov_2lw5onoxc1().s[47]++,`Couldn&#x27;t hash the password for user \&quot;${fakeUser.username}\&quot;`);// Overwrite saltRounds in config\nconst saltRounds=(cov_2lw5onoxc1().s[48]++,2);cov_2lw5onoxc1().s[49]++;config.default.bcrypt.saltRounds=saltRounds;const hashStub=(cov_2lw5onoxc1().s[50]++,sandbox.stub(bcrypt_1.default,&#x27;hash&#x27;).withArgs(sinon_1.match.string,sinon_1.match.number).rejects());cov_2lw5onoxc1().s[51]++;return user_1.hashPasswordOfUser(fakeUser).catch(error=&gt;{cov_2lw5onoxc1().f[10]++;cov_2lw5onoxc1().s[52]++;chai_1.expect(fakeUser.password).to.equal(fakeUser.password);cov_2lw5onoxc1().s[53]++;sinon_1.assert.calledOnce(hashStub);cov_2lw5onoxc1().s[54]++;sinon_1.assert.calledWith(hashStub,fakeUser.password.toString(),saltRounds);cov_2lw5onoxc1().s[55]++;chai_1.expect(error).to.have.property(&#x27;message&#x27;,expectedMessage);cov_2lw5onoxc1().s[56]++;chai_1.expect(error).to.be.nested.property(&#x27;constructor.name&#x27;,&#x27;PasswordNotHashableError&#x27;);cov_2lw5onoxc1().s[57]++;chai_1.expect(error).to.have.property(&#x27;user&#x27;,fakeUser.username);});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1aba78ac-f503-4809-89f3-f261db413e38&quot;,&quot;parentUUID&quot;:&quot;7764d4b8-83fe-4f3b-956f-dd2c21d66807&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f0f1cc47-7ba7-4896-8c2a-03d06654aae8&quot;,&quot;03a60341-3559-4f8b-8c6b-15e041dd03d2&quot;,&quot;1aba78ac-f503-4809-89f3-f261db413e38&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;a2c374e5-bcf3-4d1a-9f37-7ef833b2d033&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;7.1.1&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;saveHtml&quot;:false,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;6.1.0&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;html&quot;:&quot;false&quot;},&quot;version&quot;:&quot;5.1.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;index.html&quot;,&quot;reportDir&quot;:&quot;static\\test\\&quot;,&quot;reportTitle&quot;:&quot;group-car-api&quot;,&quot;reportPageTitle&quot;:&quot;Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:false,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;static\\test\\assets&quot;,&quot;htmlFile&quot;:&quot;C:\\Users\\Simon\\Projects\\group-car\\group-car-api\\static\\test\\index.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>